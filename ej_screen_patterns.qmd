---
title: "Exploring Patterns of Environmental Justice"
author: "Melannie Moreno Rolón"
date: "2025-11-10"
format:
  pdf:
    toc: true
    number-sections: true
execute:
  warning: false
  message: false
  results: false
editor_options:
  chunk_output_type: console
---
```{r, echo=FALSE,results='hide'}
# Load libraries
library(tidyverse)
library(sf)
library(tmap)
library(kableExtra)
```

## Introduction

This assignment explores the legacy of redlining in Los Angeles, California, and its relationship to present-day environmental and ecological conditions. Using spatial data from the EPA’s EJScreen (2023), historical HOLC neighborhood grades, and bird biodiversity observations from GBIF, we analyze how historically marginalized areas compare in terms of socioeconomic vulnerability, pollution exposure, and ecological sampling. This work reveals the impact of discriminatory housing policies and highlights the importance of equitable data representation in conservation and public health.

## Part 1: Legacy of redlining in current environmental (in)justice

Our first task is to explore historical redlining in Los Angeles and its legacy on present-day environmental justice.

1. Create a map of historical redlining neighborhoods
```{r,warning=FALSE,message=FALSE}
# Read in data
ejscreen <- st_read(here::here("data", "ejscreen",
                        "EJSCREEN_2023_BG_StatePct_with_AS_CNMI_GU_VI.gdb"),
                    quiet = T)

holc <- st_read(here::here("data", "mapping-inequality",
                               "mapping-inequality-los-angeles.json"),
                quiet = T)

birds_la <- st_read(here::here("data", "gbif-birds-LA","gbif-birds-LA.shp"),
                    quiet = T)
```

```{r,warning=FALSE,message=FALSE}
# Make sure that holc crs matches basemap crs 
holc <- st_transform(holc, 3857)
```

```{r,message=FALSE}
#| fig.width: 6
#| fig.height: 5
# Map of historical redlining neighborhoods
tmap_mode("plot")

tm_shape(holc) +
  tm_polygons(fill = "grade",
              title = "HOLC Grade",
              palette = c("A" = "#1a9850", "B" = "#4575b4", 
                          "C" = "#fee08b", "D" = "#d73027"),
    border.col = "black", lwd = 0.4) +
  tm_basemap("CartoDB.Positron") +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(position = c("right", "top")) +
  tm_layout(main.title = "Los Angeles: Historic Redlining Neighborhoods",
            legend.title.size = 1.2,
            legend.text.size = 0.8,
            frame = FALSE)
```

2. Create a table summarizing the percentage of census block groups that fall (and don't fall) within each HOLC grade
```{r}
# Custom function to check CRS and transform if needed
check_transform_crs <- function(sf1, sf2) {
if (st_crs(sf1) != st_crs(sf2)) {
    
    warning("CRS does not match. Transforming sf1 to match sf2...")
    
    # Attempt transformation
    transformed <- st_transform(sf1, st_crs(sf2))
    
    # Verify transformation
    if (st_crs(transformed) != st_crs(sf2)) {
      stop("Error: CRS transformation failed. Please check CRS definitions.")
    } else {
      message("CRS transformation successful.")
      sf1 <- transformed
    }
    
  } else {
    message("CRS already matches. No transformation needed.")
  }
  
  return(sf1)
}
```


```{r}
# Make sure crs for holc and ejscreen matches
holc <- check_transform_crs(sf1 = holc, sf2 = ejscreen)

# Simple unit test
stopifnot(st_crs(holc) == st_crs(ejscreen))
```


```{r}
# Filter EJ Screen data to LA
ejscreen_la <- ejscreen %>%
  st_filter(y = holc, .predicate = st_intersects)

# Join data
ej_holc <- st_join(ejscreen_la, holc, left = TRUE)
```

```{r}
# Create summary table of data
summ_table <- ej_holc %>%
  # Replace NA values
  mutate(grade = ifelse(is.na(grade), "No grade", grade)) %>%
  # Group by HOLC grade
  group_by(grade) %>%
  # Count block groups in each grade
  summarise(count = n()) %>%
  # Calculate percentage
  mutate(percent = round(100 * count / sum(count), 1)) %>% 
  # Display grades in order (A, B, C, D, No grade)
  mutate(grade = factor(grade, levels = c("A","B","C","D","No grade"))) %>%
  arrange(grade) %>% 
  # Remove geometries
  st_drop_geometry()
```

```{r}
# Format table
ej_holc_kable <- summ_table %>%
  select(-count) %>%
  kable(col.names = c("HOLC Grade", "Percent of Census Block Groups (%)"),
        caption = "HOLC Grades and Census Block Groups in Los Angeles",
        digits = 1) %>%
  kable_styling(full_width = FALSE, bootstrap_options = c("striped", "hover"))

ej_holc_kable
```

3. Create at least two visualizations summarizing current conditions (from the EJScreen data) within HOLC grades using the mean of the percent low income,
the percentile for Particulate Matter 2.5, and the percentile for low life expectancy. 
```{r}
# Summarize variables
ej_holc_avgs <- ej_holc %>%
  # Replace NA values in 'grade'
  mutate(grade = ifelse(is.na(grade), "No grade", grade)) %>%
  # Group by grade 
  group_by(grade) %>%
  # Calculate the mean for each variable
  summarise(
    mean_lowincpct = round(mean(LOWINCPCT, na.rm = TRUE),2),
    mean_pm25 = round(mean(P_PM25, na.rm = TRUE),2),
    mean_lifeexppct = round(mean(P_LIFEEXPPCT, na.rm = TRUE),2)) %>%
  # Display HOLC grades in order 
  mutate(grade = factor(grade, levels = c("A","B","C","D","No grade"))) %>%
  arrange(grade) %>% 
  # Remove geometries
  st_drop_geometry()
```

```{r}
# Reshape data frame to long format
ej_holc_avgs_long <- ej_holc_avgs %>%
  # Pivot data frame to long format
  pivot_longer(cols = starts_with("mean_"),
               names_to = "variable",
               values_to = "mean_val") %>%
  # Rename variables for the 'variable' column
  mutate(variable = recode(variable,
                           "mean_lowincpct" = "% Low Income",
                           "mean_pm25" = "PM2.5 Percentile",
                           "mean_lifeexppct" = "Low Life Expectancy Percentile"))
```

```{r}
# Bar Charts of Mean EJScreen Variables by HOLC Grade
# Figure 1: PM2.5 Percentile by HOLC Grade
ggplot(ej_holc_avgs, aes(x = grade, y = mean_pm25, fill = grade)) +
  geom_col() +
  labs(title = "Figure 1. Average PM2.5 Percentile by HOLC Grade",
       x = "HOLC Grade", y = "Mean PM2.5 Percentile (%)") +
  scale_fill_brewer(palette = "RdYlGn", direction = -1) +
  theme_classic()

# Figure 2: Low Life Expectancy Percentile by HOLC Grade
ggplot(ej_holc_avgs, aes(x = grade, y = mean_lifeexppct, fill = grade)) +
  geom_col() +
  labs(title = "Figure 2. Average Low Life Expectancy Percentile by HOLC Grade",
       x = "HOLC Grade", y = "Mean Life Expectancy Percentile (%)") +
  scale_fill_brewer(palette = "RdYlGn", direction = -1) +
  theme_classic()

```

### Interpretation
The plots show a clear relationship between historical redlining grades and present-day environmental and socioeconomic conditions in Los Angeles. Neighborhoods with worse HOLC grades (C and D) tend to have higher percentages of low-income residents, higher percentiles of low life expectancy, and higher PM2.5 concentrations compared to areas graded A or B. These patterns suggest that the effects of redlining persist today, with some areas experiencing greater environmental burdens and poorer health and economic outcomes. The upward trend across variables highlights how historical housing discrimination has contributed to lasting environmental injustice in the city.

## Part 2: Legacy of redlining in biodiversity observations

```{r}
# Check crs for birds_la and holc data frames
birds_la <- check_transform_crs(sf1 = birds_la, sf2 = holc)
```

```{r}
# Use st_within to ensure that bird observations are located inside HOLC polygons
birds_within_holc <- st_join(birds_la, holc, join = st_within)

# Check whether NAs  are present in data frame
if (anyNA(birds_within_holc$grade)) {
  warning("Some bird observations fall outside HOLC polygons")
}
```

```{r}
# Calculate percentage of birds within holc grades
birds_summ <- birds_within_holc %>%
  st_drop_geometry() %>%
  # Exclude bird observations with NA HOLC grades to focus on areas with historical redlining classifications
  filter(!is.na(grade)) %>%
  # Group by grade
  group_by(grade) %>%
  # Count birds in each HOLC grade
  summarise(count = n()) %>%
  # Calculate percentage of counts
  mutate(percent = 100 * count / sum(count))
```

```{r}
# Join percentages back into HOLC polygons
holc_birds_summ <- holc %>%
  left_join(birds_summ, by = c("grade"))
```

```{r}
#| fig.width: 6
#| fig.height: 5
# Plot our result
tm_shape(holc_birds_summ) +
  tm_polygons("percent",
              title = "Bird Observations (%)",
              palette = "YlOrRd",
              border.col = "black", lwd = 0.2) +
  tm_scale_bar(position = c("left", "bottom")) +
  tm_compass(position = c("right", "top")) +
  tm_basemap("CartoDB.Positron") +
  tm_layout(main.title = "Percentage of Bird Observations by HOLC Grade (2021–2023)",
            legend.text.size = 0.8,
            frame = FALSE)

```

### Interpretation

Our analysis investigated whether current environmental and ecological data collection reflects historic patterns of inequality. The results did not match findings from previous national studies, and several factors explain this discrepancy. First, earlier research noted that environmental sampling tends to be concentrated in historically affluent neighborhoods. In contrast, our analysis only included areas with available historic housing data, excluding a large portion of the region. This created a misleading assumption that all neighborhoods were equally sampled. Second, our study did not control for important variables such as vegetation, open space, and population density, all of which influence where environmental records are collected. Third, our focus on a single city, rather than multiple metropolitan areas, limits the generalizability of the results. Finally, our analysis measured raw counts rather than adjusted metrics that account for uneven sampling effort. Together, these differences highlight the importance of methodological transparency and equitable data representation when studying environmental justice issues.